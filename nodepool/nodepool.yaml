---
images-dir: /opt/nodepool/images
elements-dir: /data/nodepool/elements
webapp:
  port: 8005

zookeeper-servers:
  - host: 192.168.20.116
    port: 2281
  - host: 192.168.20.182
    port: 2281
  - host: 192.168.20.47
    port: 2281

zookeeper-tls:
  cert: /etc/nodepool/ssl/zk/cert.pem
  key: /etc/nodepool/ssl/zk/key.pem
  ca: /etc/nodepool/ssl/zk/cacert.pem

diskimages:
  - name: base
    abstract: True
    elements:
      - vm
      - simple-init
      - nodepool-base
      - growroot
      - infra-package-needs
      - otc-base
    env-vars:
      #TMPDIR: /opt/dib_tmp
      DIB_CHECKSUM: '1'
      DIB_IMAGE_CACHE: /opt/dib_cache
      DIB_JOURNAL_SIZE: '512'
      DIB_GRUB_TIMEOUT: '0'
      GIT_HTTP_LOW_SPEED_TIME: '300'
      GIT_HTTP_LOW_SPEED_LIMIT: '1000'
      DIB_SHOW_IMAGE_USAGE: '1'
      ZUUL_USER_SSH_PUBLIC_KEY: |
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDe7Sbl2sP6gasTFCh76TRfdvNesK3ZJr6LPAnls6H92xdc0/sNVBicqtiGeop/jbmTW8VVat4UXeC1eL+XOw4fonoD+tY1V+BpHtvjFloNSqH/UNwsOixuwdePl4ROkHgnPSWZVWbR1LXAOW/3zH3ez52aTgwkso8OKvH0vucWDPh5KLOB3YpHbOQ4D3J5ohVt+4AaVJRjLHMiSTSOKB4jAnd4+jJZ6GR+G39kLQ6PS6sdPC9uNu5GikAzcLp1+11XCmMbiG0mxPnQrqiEnDTAVxsPfuyX9HoteBRdVQrHWcUUEcogqcbTvGhXWYqGKVeUpGrqIilOVP47+dRvPYDruq7tMm6oM8xeex5t4jF3rneqwqQuPKGJl9ErMk+jJUVAr97Thfy3LqoTGAYeu2Vdubwaat9T1P8twg5S8FW5prKheRYytKWNRsc0wtkIS4XPPfK4fr08T1UITjZJ8eVc+cHfziP+wXoFi9MzYd8Jmgl5sp8CwJCIcOt5GiRxqBk=


  - name: base-debuntu
    abstract: True
    parent: base
    env-vars:
      DIB_APT_LOCAL_CACHE: '0'
      DIB_DISABLE_APT_CLEANUP: '1'
      DIB_DEBOOTSTRAP_EXTRA_ARGS: '--no-check-gpg'

############ CentOS and Fedora #############

  - name: fedora-30
    parent: base
    python-path: /usr/bin/python3
    pause: true
    elements:
      - fedora-minimal
    release: 30

  - name: fedora-31
    parent: base
    pause: false
    python-path: /usr/bin/python3
    elements:
      - fedora-minimal
    release: 31

  - name: fedora-32
    parent: base
    pause: false
    python-path: /usr/bin/python3
    elements:
      - fedora-minimal
    release: 32

  - name: fedora-33
    parent: base
    pause: true
    python-path: /usr/bin/python3
    elements:
      - fedora-minimal
    release: 33

  - name: centos-8
    parent: base
    pause: false
    python-path: /usr/bin/python3
    release: 8
    elements:
      - centos-minimal
      - epel
    env-vars:
      DIB_EPEL_DISABLED: '1'

  ############ Ubuntu #############
  - name: ubuntu-bionic
    parent: base-debuntu
    pause: false
    elements:
      - ubuntu-minimal
    release: bionic
    env-vars:
      DIB_DISTRIBUTION_MIRROR: 'https://ftp.halifax.rwth-aachen.de/ubuntu'
      DIB_DEBIAN_COMPONENTS: 'main,universe'

  - name: ubuntu-focal
    parent: base-debuntu
    pause: false
    elements:
      - ubuntu-minimal
    release: focal
    env-vars:
      DIB_DISTRIBUTION_MIRROR: 'https://ftp.halifax.rwth-aachen.de/ubuntu'
      DIB_DEBIAN_COMPONENTS: 'main,universe'

   ############ Debian #############
  - name: debian-buster
    parent: base-debuntu
    pause: false
    elements:
      - debian-minimal
    release: buster
    env-vars:
      DIB_DISTRIBUTION_MIRROR: 'http://ftp2.de.debian.org/debian'
      DIB_DEBIAN_SECURITY_MIRROR:
        'http://debian.mirror.lrz.de/debian-security'
      DIB_DEBIAN_SECURITY_SUBPATH: ''

labels:
  - name: pod-fedora-latest
  - name: fedora-30
  - name: fedora-31
  - name: fedora-32
  - name: fedora-32-large
  - name: debian-buster
    min-ready: 0
  - name: centos-8
  - name: ubuntu-bionic
    min-ready: 0
  - name: ubuntu-focal
    min-ready: 0

providers:
  - name: osinfra
    driver: kubernetes
      #context: zuul-context
    pools:
      - name: zuul
        labels:
          #- name: kubernetes-namespace
          #  type: namespace
          - name: pod-fedora-latest
            type: pod
            image: quay.io/opentelekomcloud/zuul-fedora:33
            cpu: 2
            memory: 2048
  - name: otc-1
    driver: openstack
    cloud: otcci-pool1
    boot-timeout: 120
    diskimages: &provider_diskimages
      - name: fedora-30
      - name: fedora-31
      - name: fedora-32
      - name: centos-8
      - name: debian-buster
      - name: ubuntu-bionic
      - name: ubuntu-focal
    pools:
      - name: pool1
        max-servers: 9
        auto-floating-ip: False
        availability-zones: &azs
          - eu-de-01
          - eu-de-02
          - eu-de-03
        networks:
          - zuul_net
        labels: &otc_labels
          - name: fedora-30
            diskimage: fedora-30
            flavor-name: s2.large.2
            key-name: nodepool
          - name: fedora-31
            diskimage: fedora-31
            flavor-name: s2.large.2
            key-name: nodepool
          - name: fedora-32
            diskimage: fedora-32
            flavor-name: s2.large.2
            key-name: nodepool
          - name: fedora-32-large
            diskimage: fedora-32
            flavor-name: s2.xlarge.2
            key-name: nodepool
          - name: debian-buster
            diskimage: debian-buster
            flavor-name: s2.large.2
            key-name: nodepool
          - name: centos-8
            diskimage: centos-8
            flavor-name: s2.large.2
            key-name: nodepool
          - name: ubuntu-bionic
            diskimage: ubuntu-bionic
            flavor-name: s2.xlarge.2
            key-name: nodepool
          - name: ubuntu-focal
            diskimage: ubuntu-focal
            flavor-name: s2.xlarge.2
            key-name: nodepool
  - name: otc-2
    driver: openstack
    cloud: otcci-pool2
    boot-timeout: 120
    diskimages: *provider_diskimages
    pools:
      - name: pool2
        auto-floating-ip: False
        availability-zones: *azs
        networks:
          - zuul_net
        labels: *otc_labels
  - name: otc-3
    driver: openstack
    cloud: otcci-pool2
    boot-timeout: 120
    diskimages: *provider_diskimages
    pools:
      - name: pool3
        max-servers: 9
        auto-floating-ip: False
        availability-zones: *azs
        networks:
          - zuul_net
        labels: *otc_labels
